---
layout: post
title: "2023ë…„ 10ì›” 28ì¼"
category: diary
---

- í´ëŸ¬ìŠ¤í„°ì— 21ì‹œì— ì™”ë‹¤. ë‚œ ì‹œê°„ì„ ì´ˆì›”í–ˆë‹¤. 

- <form action ="/api/post/new" method="POST"></form>
  => form íƒœê·¸

~~~ts
export default async function handler(req, res) {
    if (req.method == 'POST') {
        if (req.body.title == '' || req.body.content == '') {
            // req.body.title & req.body.content
            return res.status(500).json('ì œëª©ì´ë‚˜ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”')
        }
        const client = await connectDB
        const db = client.db("forum")
        let result = await db.collection('post').insertOne(req.body)
        return res.redirect(302, '/list')
    }
}
~~~

- req.bodyì— form ë‚´ë¶€ì˜ title, contentê°€ ë‹´ê²¨ìˆë‹¤.

- ì±—ì°Œí”¼í‹°ë¥¼ í™œìš©í•´ ë§Œë“¤ì–´ë³¸ íšŒì›ê°€ì…ì²˜ë¦¬

~~~ts
// localhost:3000/join
export default function Join() {
    return (
        <div className="p-20">
            <h4>íšŒì›ê°€ì… í•˜ê¸°</h4>
            <form action ="/api/post/account" method="POST">
                <input name="id" placeholder="ì•„ì´ë””"/>
                <input name="password" placeholder="ë¹„ë°€ë²ˆí˜¸"/>
                <button type="submit">ì œì¶œ</button>
            </form>
        </div>
    )
}

// /api/post/account
import { connectDB } from "@/util/database"

export default async function handler(req, res) {
    if (req.method == 'POST') {
        if (req.body.id == '' || req.body.password == '') {
            return res.status(500).json('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‘˜ ë‹¤ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤')
        }
        const client = await connectDB
        const db = client.db("forum")
        let catalog = await db.collection('accounts').find().toArray()

        const findId = catalog.find(user => user.id === req.body.id)
        // ì‹ ê¸°ìˆ 

        if (findId) {
            return res.status(500).json('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” idì…ë‹ˆë‹¤')
        }
        let result = await db.collection('accounts').insertOne(req.body)
        return res.redirect(302, '/join')
    }
}
~~~

- Javascript find í•¨ìˆ˜ ì±—ì°Œí”¼í‹°ê°€ ì‚¬ìš©ë²•ì„ ì•Œë ¤ì¤Œ

~~~md
í•´ë‹¹ ë¼ì¸ì€ JavaScriptì˜ Array.prototype.find ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°ì—´ì¸ catalogì—ì„œ 
ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ì°¾ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ catalogëŠ” ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ê°€ ë‹´ê¸´ ë°°ì—´ì´ë©°, existingUser ë³€ìˆ˜ëŠ” ì¡°ê±´ì— ë§ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼
ì €ì¥í•  ë³€ìˆ˜ì…ë‹ˆë‹¤. find ë©”ì„œë“œì˜ ë™ì‘ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1) catalog ë°°ì—´ì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ ë°˜ë³µí•˜ë©´ì„œ,
2) ì½œë°± í•¨ìˆ˜ì¸ user => user.id === req.body.idë¥¼ ê° ìš”ì†Œì— ëŒ€í•´ ì‹¤í–‰í•©ë‹ˆë‹¤.
3) 'user'ëŠ” ë°°ì—´ ë‚´ì˜ ê° ìš”ì†Œë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” user.idê°€ req.body.idì™€ ê°™ì€ì§€ ë¹„êµí•©ë‹ˆë‹¤.
4) ë§Œì•½ req.body.idì™€ ì¼ì¹˜í•˜ëŠ” IDê°€ ìˆëŠ” ê²½ìš°, findëŠ” í•´ë‹¹ ì‚¬ìš©ì ì •ë³´ë¥¼ existingUser ë³€ìˆ˜ì— í• ë‹¹í•˜ê³ , 
ë°˜ë³µì„ ë©ˆì¶¥ë‹ˆë‹¤.
5) ë§Œì•½ ì¼ì¹˜í•˜ëŠ” IDë¥¼ ì°¾ì§€ ëª»í•˜ë©´ existingUserëŠ” undefinedê°€ ë©ë‹ˆë‹¤.
6) ê²°ê³¼ì ìœ¼ë¡œ, existingUserì—ëŠ” req.body.idì™€ ì¼ì¹˜í•˜ëŠ” IDë¥¼ ê°€ì§„ ì‚¬ìš©ì ì •ë³´ê°€ ì¡´ì¬í•˜ë©´ í•´ë‹¹ ì •ë³´ê°€ ì €ì¥ë˜ê³  
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ undefinedê°€ ì €ì¥ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì½”ë“œëŠ” ì…ë ¥í•œ IDê°€ ì´ë¯¸ ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
~~~

- ê°„ë‹¨í•œ ì˜ˆì‹œ ì½”ë“œ
~~~ts
// ìˆ«ì ë°°ì—´
const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

// ì°¾ê³ ì í•˜ëŠ” ì¡°ê±´: ì§ìˆ˜ì¸ ì²« ë²ˆì§¸ ìˆ«ì
const condition = (number) => number % 2 === 0;

// find ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìš”ì†Œ ì°¾ê¸°
const foundNumber = numbers.find(condition);

if (foundNumber !== undefined) {
    console.log("ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì²« ë²ˆì§¸ ìˆ«ì:", foundNumber);
} else {
    console.log("ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìˆ«ìë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
}
~~~


~~~ts
import { connectDB } from "@/util/database"
import { ObjectId } from "mongodb"
import React from 'react'

export default async function Edit(props) {
    const client = await connectDB
    const db = client.db("forum")
    let result = await db.collection('post').findOne({ _id: new ObjectId(props.params.id) })

    return (
        <div className="p-20">
        <h4>ê¸€ ìˆ˜ì •í•˜ê¸°</h4>
        <form action ="/api/post/update" method="POST">
            <input type="hidden" name="id" value={props.params.id} />
            <input name="title" defaultValue={ result.title } />
            <input name="content" defaultValue={ result.content } />
            <button type="submit">ì œì¶œ</button>
        </form>
    </div>
    )
}
~~~

- value, ë°•ìŠ¤ì— ì›ë˜ ê¸€ ë„£ì–´ë†“ê¸°

~~~ts
<input type="hidden" name="id" value={props.params.id} /> 
~~~

 - hidden ê°’ìœ¼ë¡œ idë³´ë‚´ê¸°, ë°•ìŠ¤ë¡œëŠ” idë‘ contentë°–ì— ì „ë‹¬í• ìˆ˜ê°€ ì—†ë”ë¼.

~~~ts
<input style={{ display : 'none' }} name="_id" value={ result._id.toString() } />
~~~

  - ì•„ë‹ˆë©´ ì´ëŸ° ì‹ìœ¼ë¡œ ì „ë‹¬í•´ë„ë¨ë¨ë¨

- í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ dbë°ì´í„° ë°›ê¸°
~~~ts
'use client'

import Link from 'next/link'

export default async function ShowPage() {

    useEffect(()=> {
        
    })

    return (
        result.map((a, i)=>{
            <div className="list-item" key={i}>
                <h4><Link prefetch={ false } href={ `/detail/${result[i]._id}`} >
                    { result[i].title }
                </Link></h4>
                <p> { Date() } </p>
            </div> 
        })
    )
}
~~~

- ê²€ìƒ‰ì—”ì§„ë…¸ì¶œì— ì–´ë ¤ì›€ì„ ê²ªì„ìˆ˜ìˆë‹¤.(propsë¡œ ë°›ëŠ”ê±°ë³´ë‹¤)


~~~ts
export default async function List() {

    const client = await connectDB
    const db = client.db("forum")
    let result = await db.collection('post').find().toArray()

    result = result.map(item=>({ ...item, _id: item._id.toString() })) // ì¤‘ìš”

    return (
        <div className="list-bg"> 
            <ShowPage result={ result } />
        </div>        
    )
}
~~~

- ë‚˜ëŠ” ì €ê¸° ì¤‘ìš”í•˜ë‹¤ê³  ì£¼ì„ì¹œ ì½”ë“œê°€ ì—†ìœ¼ë©´ ì–´ì©ì§€ ë¬¸ì œê°€ ìƒê²¼ë‹¤. ì•„ë¬´ë˜ë„ ëª½ê³ ë””ë¹„ì˜ idê°€ ë¬¸ìì—´ì´ ì•„ë‹ˆë¼ì„œ ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°›ì•„ì“°ê¸° ì–´ë ¤ìš´ ë¶€ë¶„ì´ ìˆì—ˆë‚˜ë³´ë‹¤. itemì€ ì„ì˜ì˜ ë³€ìˆ˜ ì´ë¦„ì´ë‹¤.

- ì›ë³¸ result ë°°ì—´ì€ ìƒˆë¡œìš´ result ë°°ì—´ì— ë®ì–´ì”Œì›Œì§„ë‹¤. ì›ë³¸ result ë°°ì—´ì„ ê°–ê³  ìˆì–´ì•¼ í•˜ë©´ ë³€ìˆ˜ ì´ë¦„ì„ ë‹¤ë¥¸ ê±¸ë¡œ ë§Œë“¤ë©´ ë¨.

- form íƒœê·¸ë¥¼ í†µí•´ ì„œë²„ì— get, post ë“±ì˜ ìš”ì²­ ê°€ëŠ¥, ajaxë„ ì‚¬ìš©ê°€ëŠ¥(í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë§Œ ì‚¬ìš©ê°€ëŠ¥)

- JSON.stringify({a:1})ë¡œ ë°”ë””ë¥¼ ë³´ë‚´ë©´(ê°ì²´, array), apiì—ì„œëŠ” JSON.parse(req.body) ì´ëŸ°ì‹ìœ¼ë¡œ stringifyë¥¼ í’€ì–´ì•¼ ë‚´ë¶€ valueë¥¼ ê°–ë‹¤ì“¸ìˆ˜ìˆìŠ´.

- fetch ì½”ë“œëŠ” ê¸´ë°, axios ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“°ë©´ ì½”ë“œê°€ ì¤„ì–´ë“ ë‹¤ê³  í•œë‹¤.


~~~ts
'use client'

import Link from 'next/link'

export default function ShowPage({result}) {

    return (
        <div>
            {result.map((a, i)=>(
                <div className="list-item" key={i}>
                    <Link href={ `/detail/${result[i]._id}`} >
                        <h4>{ result[i].title }</h4>
                    </Link>
                    <button onClick={(e)=>{
                        fetch('/api/delete', { 
                            method : 'DELETE',
                            body : a._id
                        }).then((r)=>r.json()).then(() => {
                            e.target.parentElement.style.opacity = 0
                        })
                    }}>ğŸ—‘ï¸</button>
                    <p> 1ì›” 1ì¼ </p>
                </div> 
            ))}
        </div>
    );
}
~~~

- button onclick={(e)} ì´ eê°€ ê²ë‚˜ ì‹ ê¸°í•œ ì¸ìë¼ê³  í•œë‹¤.

~~~ts
import Link from 'next/link'

export default function ShowPage({result}) {

    return (
        <div>
            {result.map((a, i)=>(
                <div className="list-item" key={i}>
                    <Link href={ `/detail/${result[i]._id}`} >
                        <h4>{ result[i].title }</h4>
                    </Link>
                    <span onClick={(e)=>{
				        fetch('/api/test?name=gyopark&age=20')
                    }}>ğŸ—‘ï¸</span>    
                    <p> 1ì›” 1ì¼ </p>
                </div> 
            ))}
        </div>
    );
}
~~~

- query stringì˜ ì¥ì , ê°„ë‹¨í•˜ê³ , get ìš”ì²­ë„ ë°ì´í„° ì „ì†¡ì´ ê°€ëŠ¥í•˜ë‹¤.
- ë‹¨ì , ê¸¸ê³  ë³µì¡í•œ ë°ì´í„°ë¥¼ ì§‘ì–´ë„£ìœ¼ë©´ ë”ëŸ½ë‹¤. ë¯¼ê°í•œ ì •ë³´ë¥¼ ì§‘ì–´ë„£ê¸° ê·¸ë ‡ë‹¤.

~~~ts
    <span onClick={(e)=>{
        fetch('/api/abc/kim')
    }}>ğŸ—‘ï¸</span>   
~~~

- url parameter ë¬¸ë²•, /api/abc/[any].jsì— { any:'kim' }ì´ë¼ëŠ” ì¿¼ë¦¬ ì „ë‹¬, anyëŠ” ë¬´ì¡°ê±´ í•˜ë‚˜ì´ë‹¤.

~~~ts

~~~


- ìš”ì•½
(1) db document ì‚­ì œëŠ” deleteone
(2) ì„œë²„ì™€ ajaxë¡œ í†µì‹  ê°€ëŠ¥
(3) ì„œë²„ë¡œ ë°ì´í„° í†µì‹  ì‹œ  queryString / URL Parameter ë¬¸ë²•ë„ ì‚¬ìš© ê°€ëŠ¥